{% extends "base.html" %}

{% block title %}Admin - Attendees{% endblock %}

{% block content %}
<div class="admin-page">
    <h1>Webinar Attendees</h1>

    <div class="stats-panel">
        <div class="stat-card stat-primary">
            <span class="stat-value">{{ stats.total }}</span>
            <span class="stat-label">Total Registrations</span>
        </div>
        {% if stats.by_date %}
        <div class="stat-card">
            <span class="stat-value">{{ stats.by_date[0].count if stats.by_date else 0 }}</span>
            <span class="stat-label">Today</span>
        </div>
        {% endif %}
    </div>

    {% if registrations %}
    <div class="table-controls">
        <p class="result-count">Showing {{ registrations|length }} registrations</p>
        <a href="{{ url_for('admin.export_csv') }}" class="btn btn-secondary btn-sm">Export CSV</a>
    </div>

    <table class="attendees-table sortable">
        <thead>
            <tr>
                <th>
                    <a href="?sort=name&order={{ next_order if current_sort == 'name' else 'asc' }}"
                       class="sort-link {% if current_sort == 'name' %}active {{ current_order }}{% endif %}">
                        Name
                        <span class="sort-indicator"></span>
                    </a>
                </th>
                <th>
                    <a href="?sort=email&order={{ next_order if current_sort == 'email' else 'asc' }}"
                       class="sort-link {% if current_sort == 'email' %}active {{ current_order }}{% endif %}">
                        Email
                        <span class="sort-indicator"></span>
                    </a>
                </th>
                <th>
                    <a href="?sort=company&order={{ next_order if current_sort == 'company' else 'asc' }}"
                       class="sort-link {% if current_sort == 'company' %}active {{ current_order }}{% endif %}">
                        Company
                        <span class="sort-indicator"></span>
                    </a>
                </th>
                <th>
                    <a href="?sort=job_title&order={{ next_order if current_sort == 'job_title' else 'asc' }}"
                       class="sort-link {% if current_sort == 'job_title' %}active {{ current_order }}{% endif %}">
                        Job Title
                        <span class="sort-indicator"></span>
                    </a>
                </th>
                <th>
                    <a href="?sort=created_at&order={{ next_order if current_sort == 'created_at' else 'desc' }}"
                       class="sort-link {% if current_sort == 'created_at' %}active {{ current_order }}{% endif %}">
                        Registered
                        <span class="sort-indicator"></span>
                    </a>
                </th>
            </tr>
        </thead>
        <tbody>
            {% for reg in registrations %}
            <tr>
                <td>{{ reg.name }}</td>
                <td>{{ reg.email }}</td>
                <td>{{ reg.company }}</td>
                <td>{{ reg.job_title }}</td>
                <td>{{ reg.created_at.strftime('%Y-%m-%d %H:%M') }}</td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
    {% else %}
    <div class="empty-state">
        <p>No registrations yet.</p>
        <p><a href="{{ url_for('main.index') }}">Share the registration link</a> to get attendees.</p>
    </div>
    {% endif %}

    <div class="admin-nav">
        <a href="{{ url_for('main.index') }}">&larr; Back to Home</a>
    </div>
</div>
{% endblock %}
