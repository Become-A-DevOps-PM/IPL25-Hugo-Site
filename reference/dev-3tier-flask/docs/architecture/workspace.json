{
  "configuration" : {
    "scope" : "SoftwareSystem"
  },
  "description" : "C4 architecture model for a three-tier Flask application deployed on Azure",
  "documentation" : { },
  "id" : 1,
  "lastModifiedDate" : "2026-01-08T12:54:30Z",
  "model" : {
    "deploymentNodes" : [ {
      "children" : [ {
        "containerInstances" : [ {
          "containerId" : "4",
          "deploymentGroups" : [ "Default" ],
          "environment" : "Production",
          "id" : "60",
          "instanceId" : 1,
          "properties" : {
            "structurizr.dsl.identifier" : "production.f989582a-2e95-4c16-afda-4433780730e0.71c6372f-c958-49e9-a817-16e4b5f7a3b8.browserInstance"
          },
          "relationships" : [ {
            "description" : "HTTP/HTTPS requests",
            "destinationId" : "65",
            "id" : "67",
            "linkedRelationshipId" : "25",
            "sourceId" : "60",
            "technology" : "HTTPS/443"
          } ],
          "tags" : "Container Instance"
        } ],
        "description" : "Browser runtime environment",
        "environment" : "Production",
        "id" : "59",
        "instances" : "1",
        "name" : "Web Browser",
        "properties" : {
          "structurizr.dsl.identifier" : "production.f989582a-2e95-4c16-afda-4433780730e0.71c6372f-c958-49e9-a817-16e4b5f7a3b8"
        },
        "tags" : "Element,Deployment Node,Presentation Tier",
        "technology" : "Chrome, Firefox, Safari"
      } ],
      "description" : "End user's computer or mobile device",
      "environment" : "Production",
      "id" : "58",
      "instances" : "1",
      "name" : "User Device",
      "properties" : {
        "structurizr.dsl.identifier" : "production.f989582a-2e95-4c16-afda-4433780730e0"
      },
      "tags" : "Element,Deployment Node",
      "technology" : "Desktop/Laptop/Mobile"
    }, {
      "children" : [ {
        "children" : [ {
          "children" : [ {
            "containerInstances" : [ {
              "containerId" : "9",
              "deploymentGroups" : [ "Default" ],
              "environment" : "Production",
              "id" : "65",
              "instanceId" : 1,
              "properties" : {
                "structurizr.dsl.identifier" : "production.f26e6187-7a95-4e2c-aa07-c08e13f5aa76.aee7ed09-340f-43e3-937c-9aeffc443379.a965628e-cf93-427c-9687-78ef0ae1bf9c.appServerVM.appServerInstance"
              },
              "relationships" : [ {
                "description" : "Returns HTML",
                "destinationId" : "60",
                "id" : "66",
                "linkedRelationshipId" : "50",
                "sourceId" : "65",
                "technology" : "HTTP Response"
              }, {
                "description" : "Reads/writes data",
                "destinationId" : "71",
                "id" : "72",
                "linkedRelationshipId" : "26",
                "sourceId" : "65",
                "technology" : "PostgreSQL/5432"
              } ],
              "tags" : "Container Instance"
            } ],
            "description" : "vm-app (Standard_B1s, Ubuntu 24.04)",
            "environment" : "Production",
            "id" : "64",
            "instances" : "1",
            "name" : "Application Server VM",
            "properties" : {
              "structurizr.dsl.identifier" : "production.f26e6187-7a95-4e2c-aa07-c08e13f5aa76.aee7ed09-340f-43e3-937c-9aeffc443379.a965628e-cf93-427c-9687-78ef0ae1bf9c.appServerVM"
            },
            "tags" : "Element,Deployment Node,Application Tier",
            "technology" : "Azure VM"
          } ],
          "description" : "snet-default (10.0.0.0/24)",
          "environment" : "Production",
          "id" : "63",
          "infrastructureNodes" : [ {
            "description" : "Allow SSH, HTTP, HTTPS",
            "environment" : "Production",
            "id" : "68",
            "name" : "NSG",
            "properties" : {
              "structurizr.dsl.identifier" : "production.f26e6187-7a95-4e2c-aa07-c08e13f5aa76.aee7ed09-340f-43e3-937c-9aeffc443379.a965628e-cf93-427c-9687-78ef0ae1bf9c.nsgDefault"
            },
            "relationships" : [ {
              "description" : "Filters traffic",
              "destinationId" : "64",
              "id" : "69",
              "sourceId" : "68",
              "tags" : "Relationship"
            } ],
            "tags" : "Element,Infrastructure Node,NSG",
            "technology" : "Azure NSG"
          } ],
          "instances" : "1",
          "name" : "Default Subnet",
          "properties" : {
            "structurizr.dsl.identifier" : "production.f26e6187-7a95-4e2c-aa07-c08e13f5aa76.aee7ed09-340f-43e3-937c-9aeffc443379.a965628e-cf93-427c-9687-78ef0ae1bf9c"
          },
          "tags" : "Element,Deployment Node",
          "technology" : "Azure Subnet"
        } ],
        "description" : "vnet-flask-dev (10.0.0.0/16)",
        "environment" : "Production",
        "id" : "62",
        "instances" : "1",
        "name" : "Virtual Network",
        "properties" : {
          "structurizr.dsl.identifier" : "production.f26e6187-7a95-4e2c-aa07-c08e13f5aa76.aee7ed09-340f-43e3-937c-9aeffc443379"
        },
        "tags" : "Element,Deployment Node",
        "technology" : "Azure VNet"
      }, {
        "containerInstances" : [ {
          "containerId" : "20",
          "deploymentGroups" : [ "Default" ],
          "environment" : "Production",
          "id" : "71",
          "instanceId" : 1,
          "properties" : {
            "structurizr.dsl.identifier" : "production.f26e6187-7a95-4e2c-aa07-c08e13f5aa76.fd54e0a7-c630-4713-85a5-4948226a64e2.databaseInstance"
          },
          "tags" : "Container Instance"
        } ],
        "description" : "psql-flask-dev",
        "environment" : "Production",
        "id" : "70",
        "instances" : "1",
        "name" : "PostgreSQL Service",
        "properties" : {
          "structurizr.dsl.identifier" : "production.f26e6187-7a95-4e2c-aa07-c08e13f5aa76.fd54e0a7-c630-4713-85a5-4948226a64e2"
        },
        "tags" : "Element,Deployment Node,Data Tier",
        "technology" : "Azure PostgreSQL Flexible Server, Burstable B1ms"
      } ],
      "description" : "Microsoft Azure",
      "environment" : "Production",
      "id" : "61",
      "instances" : "1",
      "name" : "Azure Cloud",
      "properties" : {
        "structurizr.dsl.identifier" : "production.f26e6187-7a95-4e2c-aa07-c08e13f5aa76"
      },
      "tags" : "Element,Deployment Node",
      "technology" : "Azure IaaS"
    } ],
    "people" : [ {
      "description" : "Interacts with the demo application via web browser",
      "id" : "1",
      "name" : "Application User",
      "properties" : {
        "structurizr.dsl.identifier" : "user"
      },
      "relationships" : [ {
        "description" : "Uses demo application",
        "destinationId" : "3",
        "id" : "22",
        "sourceId" : "1",
        "tags" : "Relationship",
        "technology" : "HTTPS"
      }, {
        "description" : "Interacts with",
        "destinationId" : "4",
        "id" : "24",
        "sourceId" : "1",
        "tags" : "Relationship",
        "technology" : "Mouse, keyboard"
      } ],
      "tags" : "Element,Person,Primary Actor"
    }, {
      "description" : "Deploys and maintains the application",
      "id" : "2",
      "name" : "Developer",
      "properties" : {
        "structurizr.dsl.identifier" : "developer"
      },
      "relationships" : [ {
        "description" : "Deploys and monitors",
        "destinationId" : "3",
        "id" : "23",
        "sourceId" : "2",
        "tags" : "Relationship",
        "technology" : "SSH, HTTPS"
      } ],
      "tags" : "Element,Person,Secondary Actor"
    } ],
    "softwareSystems" : [ {
      "containers" : [ {
        "components" : [ {
          "description" : "Rendered HTML documents from server",
          "documentation" : { },
          "id" : "5",
          "name" : "HTML Pages",
          "properties" : {
            "structurizr.dsl.identifier" : "flaskApp.browser.htmlPages"
          },
          "relationships" : [ {
            "description" : "Styled by",
            "destinationId" : "6",
            "id" : "28",
            "sourceId" : "5",
            "tags" : "Relationship",
            "technology" : "CSS link"
          }, {
            "description" : "Contains",
            "destinationId" : "8",
            "id" : "29",
            "sourceId" : "5",
            "tags" : "Relationship",
            "technology" : "HTML anchors"
          }, {
            "description" : "Contains",
            "destinationId" : "7",
            "id" : "30",
            "sourceId" : "5",
            "tags" : "Relationship",
            "technology" : "HTML form"
          } ],
          "tags" : "Element,Component",
          "technology" : "HTML5"
        }, {
          "description" : "Visual styling and layout",
          "documentation" : { },
          "id" : "6",
          "name" : "CSS Stylesheet",
          "properties" : {
            "structurizr.dsl.identifier" : "flaskApp.browser.cssStyles"
          },
          "tags" : "Element,Component",
          "technology" : "CSS3 (style.css)"
        }, {
          "description" : "User input forms for data entry",
          "documentation" : { },
          "id" : "7",
          "name" : "HTML Forms",
          "properties" : {
            "structurizr.dsl.identifier" : "flaskApp.browser.htmlForms"
          },
          "relationships" : [ {
            "description" : "Form submission triggers",
            "destinationId" : "8",
            "id" : "27",
            "sourceId" : "7",
            "tags" : "Relationship",
            "technology" : "HTTP POST"
          }, {
            "description" : "POST form data",
            "destinationId" : "10",
            "id" : "34",
            "sourceId" : "7",
            "tags" : "Relationship,Tier1to2",
            "technology" : "HTTPS"
          }, {
            "description" : "POST form data",
            "destinationId" : "9",
            "id" : "35",
            "linkedRelationshipId" : "34",
            "sourceId" : "7",
            "technology" : "HTTPS"
          } ],
          "tags" : "Element,Component",
          "technology" : "HTML Form Elements"
        }, {
          "description" : "Links and page navigation",
          "documentation" : { },
          "id" : "8",
          "name" : "Navigation",
          "properties" : {
            "structurizr.dsl.identifier" : "flaskApp.browser.navigation"
          },
          "relationships" : [ {
            "description" : "GET requests",
            "destinationId" : "10",
            "id" : "31",
            "sourceId" : "8",
            "tags" : "Relationship,Tier1to2",
            "technology" : "HTTPS"
          }, {
            "description" : "GET requests",
            "destinationId" : "9",
            "id" : "32",
            "linkedRelationshipId" : "31",
            "sourceId" : "8",
            "technology" : "HTTPS"
          } ],
          "tags" : "Element,Component",
          "technology" : "HTML Anchors"
        } ],
        "description" : "Renders HTML, handles user interaction, submits forms",
        "documentation" : { },
        "group" : "Tier 1: Presentation",
        "id" : "4",
        "name" : "Web Browser",
        "properties" : {
          "structurizr.dsl.identifier" : "flaskApp.browser"
        },
        "relationships" : [ {
          "description" : "HTTP/HTTPS requests",
          "destinationId" : "9",
          "id" : "25",
          "sourceId" : "4",
          "tags" : "Relationship",
          "technology" : "HTTPS/443"
        }, {
          "description" : "GET requests",
          "destinationId" : "10",
          "id" : "33",
          "linkedRelationshipId" : "31",
          "sourceId" : "4",
          "technology" : "HTTPS"
        } ],
        "tags" : "Element,Container,Presentation Tier,Client",
        "technology" : "Chrome, Firefox, Safari, Edge"
      }, {
        "components" : [ {
          "description" : "Reverse proxy, SSL termination, static file serving",
          "documentation" : { },
          "id" : "10",
          "name" : "nginx",
          "properties" : {
            "structurizr.dsl.identifier" : "flaskApp.appServer.nginx"
          },
          "relationships" : [ {
            "description" : "Proxy requests",
            "destinationId" : "11",
            "id" : "36",
            "sourceId" : "10",
            "tags" : "Relationship",
            "technology" : "HTTP/5001"
          }, {
            "description" : "Serves directly",
            "destinationId" : "19",
            "id" : "37",
            "sourceId" : "10",
            "tags" : "Relationship",
            "technology" : "File I/O"
          } ],
          "tags" : "Element,Component",
          "technology" : "nginx"
        }, {
          "description" : "WSGI server, process management",
          "documentation" : { },
          "id" : "11",
          "name" : "Gunicorn",
          "properties" : {
            "structurizr.dsl.identifier" : "flaskApp.appServer.gunicorn"
          },
          "relationships" : [ {
            "description" : "WSGI calls",
            "destinationId" : "12",
            "id" : "38",
            "sourceId" : "11",
            "tags" : "Relationship",
            "technology" : "Python"
          } ],
          "tags" : "Element,Component",
          "technology" : "Gunicorn (2 workers)"
        }, {
          "description" : "Application factory, configuration",
          "documentation" : { },
          "id" : "12",
          "name" : "Flask App",
          "properties" : {
            "structurizr.dsl.identifier" : "flaskApp.appServer.flaskApp_internal"
          },
          "relationships" : [ {
            "description" : "Routes /",
            "destinationId" : "13",
            "id" : "39",
            "sourceId" : "12",
            "tags" : "Relationship",
            "technology" : "Blueprint"
          }, {
            "description" : "Routes /demo",
            "destinationId" : "14",
            "id" : "40",
            "sourceId" : "12",
            "tags" : "Relationship",
            "technology" : "Blueprint"
          }, {
            "description" : "Routes /api",
            "destinationId" : "15",
            "id" : "41",
            "sourceId" : "12",
            "tags" : "Relationship",
            "technology" : "Blueprint"
          } ],
          "tags" : "Element,Component",
          "technology" : "Flask create_app()"
        }, {
          "description" : "Landing page route",
          "documentation" : { },
          "id" : "13",
          "name" : "Main Blueprint",
          "properties" : {
            "structurizr.dsl.identifier" : "flaskApp.appServer.mainBlueprint"
          },
          "relationships" : [ {
            "description" : "Renders landing.html",
            "destinationId" : "18",
            "id" : "44",
            "sourceId" : "13",
            "tags" : "Relationship",
            "technology" : "Jinja2"
          } ],
          "tags" : "Element,Component",
          "technology" : "main_bp: GET /"
        }, {
          "description" : "Demo form handling",
          "documentation" : { },
          "id" : "14",
          "name" : "Demo Blueprint",
          "properties" : {
            "structurizr.dsl.identifier" : "flaskApp.appServer.demoBlueprint"
          },
          "relationships" : [ {
            "description" : "CRUD operations",
            "destinationId" : "16",
            "id" : "42",
            "sourceId" : "14",
            "tags" : "Relationship",
            "technology" : "Python"
          }, {
            "description" : "Renders demo.html",
            "destinationId" : "18",
            "id" : "45",
            "sourceId" : "14",
            "tags" : "Relationship",
            "technology" : "Jinja2"
          } ],
          "tags" : "Element,Component",
          "technology" : "demo_bp: GET/POST /demo"
        }, {
          "description" : "JSON API endpoints",
          "documentation" : { },
          "id" : "15",
          "name" : "API Blueprint",
          "properties" : {
            "structurizr.dsl.identifier" : "flaskApp.appServer.apiBlueprint"
          },
          "relationships" : [ {
            "description" : "Query entries",
            "destinationId" : "16",
            "id" : "43",
            "sourceId" : "15",
            "tags" : "Relationship",
            "technology" : "Python"
          }, {
            "description" : "Returns JSON",
            "destinationId" : "4",
            "id" : "54",
            "sourceId" : "15",
            "tags" : "Relationship,Tier2to1",
            "technology" : "HTTP Response"
          } ],
          "tags" : "Element,Component",
          "technology" : "api_bp: GET /api/*"
        }, {
          "description" : "Business logic for entries",
          "documentation" : { },
          "id" : "16",
          "name" : "Entry Service",
          "properties" : {
            "structurizr.dsl.identifier" : "flaskApp.appServer.entryService"
          },
          "relationships" : [ {
            "description" : "Uses",
            "destinationId" : "17",
            "id" : "46",
            "sourceId" : "16",
            "tags" : "Relationship",
            "technology" : "Python"
          } ],
          "tags" : "Element,Component",
          "technology" : "EntryService class"
        }, {
          "description" : "ORM model for entries table",
          "documentation" : { },
          "id" : "17",
          "name" : "Entry Model",
          "properties" : {
            "structurizr.dsl.identifier" : "flaskApp.appServer.entryModel"
          },
          "relationships" : [ {
            "description" : "SQL queries",
            "destinationId" : "21",
            "id" : "55",
            "sourceId" : "17",
            "tags" : "Relationship,Tier2to3",
            "technology" : "psycopg2"
          }, {
            "description" : "SQL queries",
            "destinationId" : "20",
            "id" : "56",
            "linkedRelationshipId" : "55",
            "sourceId" : "17",
            "technology" : "psycopg2"
          } ],
          "tags" : "Element,Component",
          "technology" : "SQLAlchemy Model"
        }, {
          "description" : "HTML page templates",
          "documentation" : { },
          "id" : "18",
          "name" : "Jinja2 Templates",
          "properties" : {
            "structurizr.dsl.identifier" : "flaskApp.appServer.templates"
          },
          "relationships" : [ {
            "description" : "Returns HTML",
            "destinationId" : "5",
            "id" : "47",
            "sourceId" : "18",
            "tags" : "Relationship,Tier2to1",
            "technology" : "HTTP Response"
          }, {
            "description" : "Returns HTML",
            "destinationId" : "4",
            "id" : "48",
            "linkedRelationshipId" : "47",
            "sourceId" : "18",
            "technology" : "HTTP Response"
          } ],
          "tags" : "Element,Component",
          "technology" : "base.html, landing.html, demo.html"
        }, {
          "description" : "CSS stylesheets",
          "documentation" : { },
          "id" : "19",
          "name" : "Static Files",
          "properties" : {
            "structurizr.dsl.identifier" : "flaskApp.appServer.staticFiles"
          },
          "relationships" : [ {
            "description" : "Returns CSS",
            "destinationId" : "6",
            "id" : "51",
            "sourceId" : "19",
            "tags" : "Relationship,Tier2to1",
            "technology" : "HTTP Response"
          }, {
            "description" : "Returns CSS",
            "destinationId" : "4",
            "id" : "52",
            "linkedRelationshipId" : "51",
            "sourceId" : "19",
            "technology" : "HTTP Response"
          } ],
          "tags" : "Element,Component",
          "technology" : "static/css/style.css"
        } ],
        "description" : "Handles HTTP requests, business logic, and page rendering",
        "documentation" : { },
        "group" : "Tier 2: Application",
        "id" : "9",
        "name" : "Application Server",
        "properties" : {
          "structurizr.dsl.identifier" : "flaskApp.appServer"
        },
        "relationships" : [ {
          "description" : "Reads/writes data",
          "destinationId" : "20",
          "id" : "26",
          "sourceId" : "9",
          "tags" : "Relationship",
          "technology" : "PostgreSQL/5432"
        }, {
          "description" : "Returns HTML",
          "destinationId" : "5",
          "id" : "49",
          "linkedRelationshipId" : "47",
          "sourceId" : "9",
          "technology" : "HTTP Response"
        }, {
          "description" : "Returns HTML",
          "destinationId" : "4",
          "id" : "50",
          "linkedRelationshipId" : "47",
          "sourceId" : "9",
          "technology" : "HTTP Response"
        }, {
          "description" : "Returns CSS",
          "destinationId" : "6",
          "id" : "53",
          "linkedRelationshipId" : "51",
          "sourceId" : "9",
          "technology" : "HTTP Response"
        }, {
          "description" : "SQL queries",
          "destinationId" : "21",
          "id" : "57",
          "linkedRelationshipId" : "55",
          "sourceId" : "9",
          "technology" : "psycopg2"
        } ],
        "tags" : "Element,Container,Application Tier,Server",
        "technology" : "Ubuntu 24.04, nginx, Python, Gunicorn"
      }, {
        "components" : [ {
          "description" : "Stores entry records",
          "documentation" : { },
          "id" : "21",
          "name" : "entries Table",
          "properties" : {
            "structurizr.dsl.identifier" : "flaskApp.database.entriesTable"
          },
          "tags" : "Element,Component",
          "technology" : "id, value, created_at"
        } ],
        "description" : "Persistent storage for application data",
        "documentation" : { },
        "group" : "Tier 3: Data",
        "id" : "20",
        "name" : "PostgreSQL Database",
        "properties" : {
          "structurizr.dsl.identifier" : "flaskApp.database"
        },
        "tags" : "Element,Container,Data Tier,Database",
        "technology" : "Azure PostgreSQL Flexible Server"
      } ],
      "description" : "Demo application demonstrating presentation, application, and data tiers",
      "documentation" : {
        "decisions" : [ {
          "content" : "# 1. Use Pure IaaS Approach\n\nDate: 2025-12-15\n\n## Status\n\nAccepted\n\n## Context\n\nWe need to choose an infrastructure approach for hosting the webinar registration website on Azure.\n\nOptions considered:\n1. Pure IaaS (Virtual Machines)\n2. PaaS (App Service, Container Apps)\n3. Serverless (Functions)\n\n## Decision\n\nWe will use a pure IaaS approach with self-managed Ubuntu VMs for compute.\n\n## Consequences\n\n**Positive:**\n- Full control over the environment\n- Traditional Linux administration skills applicable\n- No vendor lock-in for compute layer\n- Educational value for understanding infrastructure fundamentals\n\n**Negative:**\n- More operational overhead (patching, monitoring)\n- No built-in auto-scaling\n- Requires more infrastructure knowledge\n\n**Exception:**\n- PostgreSQL will use Azure Flexible Server (PaaS) for practical reasons (managed backups, HA)\n",
          "date" : "2025-12-15T00:00:00Z",
          "format" : "Markdown",
          "id" : "1",
          "status" : "Accepted",
          "title" : "Use Pure IaaS Approach"
        }, {
          "content" : "# 2. Use Python Flask for Web Application\n\nDate: 2025-12-15\n\n## Status\n\nAccepted\n\n## Context\n\nWe need to select a web framework for the registration application.\n\nOptions considered:\n1. Python Flask\n2. Python Django\n3. Node.js Express\n4. Go with Gin\n\n## Decision\n\nWe will use Python Flask with:\n- Jinja2 for server-side templating\n- SQLAlchemy for database ORM\n- Gunicorn as WSGI production server\n\n## Consequences\n\n**Positive:**\n- Lightweight and simple to understand\n- Excellent documentation and community\n- Easy to deploy on Linux VMs\n- Good integration with PostgreSQL via psycopg2\n\n**Negative:**\n- Synchronous by default (acceptable for expected load)\n- Less built-in features than Django (acceptable for simple app)\n",
          "date" : "2025-12-15T00:00:00Z",
          "format" : "Markdown",
          "id" : "2",
          "status" : "Accepted",
          "title" : "Use Python Flask for Web Application"
        }, {
          "content" : "# 3. Use Bastion Host for SSH Access\n\nDate: 2025-12-15\n\n## Status\n\nSuperseded by [ADR-0004](#4)\n\n## Context\n\nWe need secure administrative access to internal VMs without exposing them directly to the internet.\n\nOptions considered:\n1. Direct SSH access to all VMs (public IPs)\n2. VPN gateway\n3. Azure Bastion service (PaaS)\n4. Self-managed bastion host (jump server)\n\n## Decision\n\nWe will use a self-managed bastion host (Ubuntu VM) as an SSH jump server.\n\n## Consequences\n\n**Positive:**\n- Only one public SSH endpoint exposed\n- Internal VMs have no public IPs (reduced attack surface)\n- Full control over bastion configuration\n- Consistent with IaaS approach\n\n**Negative:**\n- Additional VM to maintain\n- Single point of failure for admin access\n- Requires SSH key management\n\n## Superseded\n\nThis decision was superseded by ADR-0004 which adopts direct SSH access for the simplified learning environment. The bastion host pattern remains valid for production deployments.\n",
          "date" : "2025-12-15T00:00:00Z",
          "format" : "Markdown",
          "id" : "3",
          "links" : [ {
            "description" : "Superseded by",
            "id" : "4"
          } ],
          "status" : "Superseded",
          "title" : "Use Bastion Host for SSH Access"
        }, {
          "content" : "# 4. Use Direct SSH Access for Simplified Learning Environment\n\nDate: 2025-01-08\n\n## Status\n\nAccepted\n\n## Context\n\nThe dev-3tier-flask project is designed as a learning environment for application development, not infrastructure security. The bastion host pattern (ADR-0003) added complexity that distracted from the primary learning objectives.\n\nWe needed to balance:\n- Simplicity for learning application development patterns\n- Reasonable security for a temporary learning environment\n- Cost efficiency for students\n- Fast deployment and troubleshooting\n\n## Decision\n\nWe will use direct SSH access to the application server VM, eliminating the bastion host.\n\nThe simplified architecture:\n- Single VM with public IP\n- SSH (port 22) allowed from Internet\n- fail2ban for SSH brute-force protection\n- PostgreSQL with public access (firewall allows all IPs)\n\n## Consequences\n\n**Positive:**\n- Simpler architecture focused on application development\n- Faster deployment (10-15 minutes vs 20-40 minutes)\n- Lower cost (~$20/month vs ~$44/month)\n- Easier troubleshooting with direct access\n- Clearer mental model for learners\n\n**Negative:**\n- Less secure than bastion host pattern\n- Not suitable for production workloads\n- SSH exposed directly to Internet (mitigated by fail2ban)\n- Public PostgreSQL access is a security risk\n\n## Security Mitigations\n\nDespite reduced security, we maintain:\n- SSH key authentication (no password auth)\n- fail2ban with aggressive settings\n- Self-signed SSL for HTTPS\n- PostgreSQL requires SSL connections\n- NSG limits inbound ports to SSH, HTTP, HTTPS only\n\n## When to Use Bastion Pattern\n\nThe bastion host pattern (ADR-0003) should be used when:\n- Deploying production workloads\n- Learning infrastructure security concepts\n- Multiple VMs require SSH access\n- Compliance requirements mandate network segmentation\n\nFor production patterns, see `reference/stage-ultimate/`.\n",
          "date" : "2025-01-08T00:00:00Z",
          "format" : "Markdown",
          "id" : "4",
          "status" : "Accepted",
          "title" : "Use Direct SSH Access for Simplified Learning Environment"
        } ],
        "sections" : [ {
          "content" : "# Flask Three-Tier Application\n\n## Overview\n\nThe Flask Three-Tier Application is a demonstration of classic three-tier architecture deployed on Azure. It separates concerns into presentation, application, and data tiers for clarity and maintainability.\n\nThis documentation follows the [C4 model](https://c4model.com/) and provides detailed explanations at each architectural level.\n\n### Three-Tier Architecture\n\n| Tier | Location | Technology | Responsibility |\n|------|----------|------------|----------------|\n| **Presentation** | Web Browser | HTML, CSS, Forms | User interface, interaction |\n| **Application** | Azure VM | Flask, nginx, Gunicorn | Business logic, routing |\n| **Data** | Azure PostgreSQL | PostgreSQL 16 | Persistent storage |\n\n```\n┌─────────────────────────────────────────────────────────────────┐\n│  TIER 1: PRESENTATION (Browser)                                  │\n│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐              │\n│  │ HTML Pages  │  │ CSS Styles  │  │ HTML Forms  │              │\n│  └─────────────┘  └─────────────┘  └─────────────┘              │\n└─────────────────────────────────────────────────────────────────┘\n                              │\n                              │ HTTPS\n                              ▼\n┌─────────────────────────────────────────────────────────────────┐\n│  TIER 2: APPLICATION (Flask Server)                              │\n│  ┌───────┐  ┌──────────┐  ┌───────────┐  ┌──────────┐          │\n│  │ nginx │──│ Gunicorn │──│ Flask App │──│ Services │          │\n│  └───────┘  └──────────┘  └───────────┘  └──────────┘          │\n└─────────────────────────────────────────────────────────────────┘\n                              │\n                              │ PostgreSQL\n                              ▼\n┌─────────────────────────────────────────────────────────────────┐\n│  TIER 3: DATA (PostgreSQL)                                       │\n│  ┌─────────────────────────────────────────────────┐            │\n│  │ entries table (id, value, created_at)           │            │\n│  └─────────────────────────────────────────────────┘            │\n└─────────────────────────────────────────────────────────────────┘\n```\n\n### Key Features\n\n- **Landing Page**: Welcome page with navigation (`/`)\n- **Demo Application**: Form-based entry management (`/demo`)\n- **API Endpoints**: JSON API for entries and health (`/api/*`)\n\n### Technology Stack\n\n| Layer | Technology |\n|-------|------------|\n| Frontend | Server-side rendered HTML (Jinja2), CSS3 |\n| Backend | Python Flask 3.0+ with Gunicorn WSGI |\n| Database | PostgreSQL 16 (Azure Flexible Server) |\n| Web Server | nginx reverse proxy with self-signed SSL |\n| Infrastructure | Azure IaaS (Single VM + PaaS Database) |\n| IaC | Bicep (declarative) |\n\n### Architecture Levels (C4 Model)\n\n| Level | View | Description |\n|-------|------|-------------|\n| **C1** | System Context | Actors and the system boundary |\n| **C2** | Containers | The three tiers as containers |\n| **C3** | Components | Internals of each tier |\n| **Deployment** | Infrastructure | Azure deployment topology |\n\n### Quick Links\n\n- [System Context (C1)](02-context.md) - Who uses the system?\n- [Containers (C2)](03-containers.md) - What are the three tiers?\n- [Components (C3)](04-components.md) - How do components work within each tier?\n- [Deployment](05-deployment.md) - How is it deployed on Azure?\n\n### Architecture Decisions\n\nKey architectural decisions are documented in the ADRs:\n\n- **ADR-0001**: Use Pure IaaS Approach\n- **ADR-0002**: Use Python Flask for Web Application\n- **ADR-0003**: Use Bastion Host for SSH Access (Superseded)\n- **ADR-0004**: Use Direct SSH for Simplified Learning Environment\n\n### Source Code Structure\n\n```\napplication/\n├── app/\n│   ├── __init__.py           # Application factory\n│   ├── extensions.py         # Flask extensions (db, migrate)\n│   ├── routes/\n│   │   ├── main.py           # Tier 2: Landing page blueprint\n│   │   ├── demo.py           # Tier 2: Demo form blueprint\n│   │   └── api.py            # Tier 2: API blueprint\n│   ├── models/\n│   │   └── entry.py          # Tier 3: ORM model\n│   ├── services/\n│   │   └── entry_service.py  # Tier 2: Business logic\n│   ├── templates/            # Tier 1: HTML templates\n│   │   ├── base.html\n│   │   ├── landing.html\n│   │   └── demo.html\n│   └── static/css/           # Tier 1: Stylesheets\n│       └── style.css\n├── config.py                 # Configuration classes\n└── wsgi.py                   # Gunicorn entry point\n```\n",
          "filename" : "01-overview.md",
          "format" : "Markdown",
          "order" : 1,
          "title" : ""
        }, {
          "content" : "# System Context (C1)\n\n## System Context (C4 Model Level 1)\n\nThis document provides the highest level view of the Flask Three-Tier Application, showing how it fits into the broader environment of users.\n\n### System Context Diagram\n\n![](embed:C1-Context)\n\n### Context Description\n\n#### The System\n\n**Flask Three-Tier Application** is a demo web application that:\n\n- Provides a landing page with navigation to the demo\n- Offers a demo form for creating and viewing entries\n- Stores data persistently in PostgreSQL\n- Exposes JSON API endpoints for entries and health checks\n- Runs on simplified Azure infrastructure (single VM)\n\n#### Users (Actors)\n\n| Actor | Description | Interaction |\n|-------|-------------|-------------|\n| **Application User** | Anyone accessing the demo application | Uses demo form, views entries via browser (HTTPS) |\n| **Developer** | Person deploying and maintaining the application | SSH access for deployment, monitors via browser (HTTPS) |\n\n### Key Architectural Decisions\n\n1. **Simplified IaaS Approach**: Single VM running both nginx and Flask for learning environments\n2. **Python Flask**: Lightweight web framework with Jinja2 templating (SSR) and SQLAlchemy ORM\n3. **PostgreSQL**: Robust open-source relational database, available as PaaS on Azure (Flexible Server)\n4. **Direct SSH Access**: No bastion host - simplified for learning, not production\n5. **Public Database Access**: PostgreSQL exposed publicly for simplicity (learning environment only)\n\n### Quality Attributes\n\nKey non-functional requirements affecting architecture:\n\n| Attribute | Requirement | Impact |\n|-----------|-------------|--------|\n| **Simplicity** | Easy to understand and deploy | Single VM design, minimal network complexity |\n| **Cost** | Minimize learning environment costs | ~$20/month with smallest SKUs |\n| **Response Time** | Pages load < 3 seconds | nginx caching, optimized queries |\n| **Security** | HTTPS only | SSL termination at nginx (self-signed) |\n\n### Scope Boundary\n\n#### In Scope\n\n- Landing page and demo application\n- Entry creation and listing\n- JSON API for entries\n- HTTPS encryption\n- Health monitoring endpoint\n\n#### Out of Scope (Learning Environment)\n\n- User authentication/authorization\n- Network segmentation (bastion host)\n- Private database access\n- High availability\n- Auto-scaling\n\n### Next Level\n\nSee [Containers (C2)](03-containers.md) for the technical building blocks that make up this system.\n",
          "filename" : "02-context.md",
          "format" : "Markdown",
          "order" : 2,
          "title" : ""
        }, {
          "content" : "# Containers (C2)\n\n## Three-Tier Container Architecture\n\nThis document shows the three tiers of the application as C4 containers - the high-level building blocks that make up the system.\n\n> **C4 \"Container\"** = A separately deployable/runnable unit, NOT a Docker container.\n\n### Container Diagram\n\n![](embed:C2-Containers)\n\n### The Three Tiers\n\n| Tier | Container | Technology | Deployment |\n|------|-----------|------------|------------|\n| **Presentation** | Web Browser | HTML5, CSS3 | User's device |\n| **Application** | Application Server | Flask, nginx, Gunicorn | Azure VM |\n| **Data** | PostgreSQL Database | PostgreSQL 16 | Azure PaaS |\n\n### Tier 1: Presentation (Web Browser)\n\nThe presentation tier runs entirely in the user's web browser.\n\n| Component | Technology | Purpose |\n|-----------|------------|---------|\n| HTML Pages | HTML5 | Rendered documents from Jinja2 templates |\n| CSS Styles | CSS3 | Visual styling (style.css) |\n| HTML Forms | HTML Form Elements | User input for data entry |\n| Navigation | HTML Anchors | Page navigation and links |\n\n**Key Characteristics:**\n- Server-side rendering (no JavaScript framework)\n- Forms use standard HTML POST submissions\n- CSS provides responsive layout\n- Browser handles all presentation logic\n\n### Tier 2: Application (Flask Server)\n\nThe application tier handles all business logic and page rendering.\n\n| Layer | Components | Purpose |\n|-------|------------|---------|\n| **Infrastructure** | nginx, Gunicorn | HTTP handling, SSL, process management |\n| **Routing** | Flask Blueprints | URL routing to handlers |\n| **Business Logic** | EntryService | CRUD operations |\n| **Data Access** | Entry Model | ORM mapping |\n| **Templates** | Jinja2 | HTML generation |\n\n**Key Characteristics:**\n- Single VM running nginx + Gunicorn + Flask\n- Blueprint-based route organization\n- Service layer for business logic\n- SQLAlchemy ORM for data access\n\n### Tier 3: Data (PostgreSQL)\n\nThe data tier provides persistent storage.\n\n| Table | Columns | Purpose |\n|-------|---------|---------|\n| `entries` | id, value, created_at | Stores demo entries |\n\n**Key Characteristics:**\n- Azure PostgreSQL Flexible Server (PaaS)\n- Public access enabled for learning environment\n- SSL required for connections\n- Schema managed by SQLAlchemy\n\n### Data Flow Between Tiers\n\n#### User Submits Form (Tier 1 → Tier 2 → Tier 3)\n\n```\nBrowser                    Application Server                  Database\n   │                              │                               │\n   │  POST /demo (form data)      │                               │\n   │─────────────────────────────>│                               │\n   │                              │  INSERT INTO entries          │\n   │                              │──────────────────────────────>│\n   │                              │              OK               │\n   │                              │<──────────────────────────────│\n   │  302 Redirect                │                               │\n   │<─────────────────────────────│                               │\n   │                              │                               │\n```\n\n#### User Views Page (Tier 1 ← Tier 2 ← Tier 3)\n\n```\nBrowser                    Application Server                  Database\n   │                              │                               │\n   │  GET /demo                   │                               │\n   │─────────────────────────────>│                               │\n   │                              │  SELECT * FROM entries        │\n   │                              │──────────────────────────────>│\n   │                              │       [entry rows]            │\n   │                              │<──────────────────────────────│\n   │  HTML (rendered page)        │                               │\n   │<─────────────────────────────│                               │\n   │                              │                               │\n```\n\n### Network Architecture\n\n```\n┌─────────────────────────────────────────────────────────────────┐\n│  USER DEVICE (Presentation Tier)                                 │\n│  ┌─────────────────────────────────────────────────────────┐    │\n│  │  Web Browser                                             │    │\n│  │  - Renders HTML/CSS                                      │    │\n│  │  - Handles forms                                         │    │\n│  │  - Manages navigation                                    │    │\n│  └─────────────────────────────────────────────────────────┘    │\n└─────────────────────────────────────────────────────────────────┘\n                              │\n                              │ HTTPS/443\n                              ▼\n┌─────────────────────────────────────────────────────────────────┐\n│  AZURE VM (Application Tier) - 10.0.0.x                          │\n│  ┌─────────────────────────────────────────────────────────┐    │\n│  │  nginx (:443) → Gunicorn (:5001) → Flask                │    │\n│  │  - SSL termination                                       │    │\n│  │  - Reverse proxy                                         │    │\n│  │  - Static file serving                                   │    │\n│  └─────────────────────────────────────────────────────────┘    │\n└─────────────────────────────────────────────────────────────────┘\n                              │\n                              │ PostgreSQL/5432 (SSL)\n                              ▼\n┌─────────────────────────────────────────────────────────────────┐\n│  AZURE POSTGRESQL (Data Tier) - psql-flask-dev                   │\n│  ┌─────────────────────────────────────────────────────────┐    │\n│  │  PostgreSQL Flexible Server                              │    │\n│  │  - Database: flask                                       │    │\n│  │  - Table: entries                                        │    │\n│  └─────────────────────────────────────────────────────────┘    │\n└─────────────────────────────────────────────────────────────────┘\n```\n\n### Technology Choices by Tier\n\n| Tier | Choice | Rationale |\n|------|--------|-----------|\n| **Presentation** | Server-side HTML | Simple, no JS framework needed |\n| **Presentation** | CSS3 | Standard styling, responsive |\n| **Application** | Flask | Lightweight, blueprint support |\n| **Application** | nginx | Industry standard reverse proxy |\n| **Application** | Gunicorn | Production-grade WSGI server |\n| **Application** | SQLAlchemy | Powerful ORM, migration support |\n| **Data** | PostgreSQL | Robust, Azure PaaS available |\n\n### Next Level\n\nSee [Components (C3)](04-components.md) for the internal structure of each tier.\n",
          "filename" : "03-containers.md",
          "format" : "Markdown",
          "order" : 3,
          "title" : ""
        }, {
          "content" : "# Components (C3)\n\n## Component Architecture by Tier\n\nThis document zooms into each tier to show the internal components and their relationships. The C4 model provides three component diagrams - one for each tier.\n\n### C3 Views Available\n\n| View | Tier | Shows |\n|------|------|-------|\n| C3-PresentationTier | Browser | HTML, CSS, Forms, Navigation |\n| C3-ApplicationTier | Flask Server | nginx, Gunicorn, Blueprints, Services |\n| C3-DataTier | PostgreSQL | Database schema |\n\n---\n\n## Tier 1: Presentation Components (Browser)\n\n### Component Diagram\n\n![](embed:C3-PresentationTier)\n\n### What Runs in the Browser\n\n| Component | Technology | Source | Purpose |\n|-----------|------------|--------|---------|\n| **HTML Pages** | HTML5 | Jinja2 templates | Document structure |\n| **CSS Stylesheet** | CSS3 | `static/css/style.css` | Visual styling |\n| **HTML Forms** | HTML Form Elements | `demo.html` | User input |\n| **Navigation** | HTML Anchors | All templates | Page links |\n\n### Browser Component Details\n\n#### HTML Pages\n\nThe browser renders HTML documents generated by Jinja2 on the server:\n\n- `landing.html` - Landing page with navigation links\n- `demo.html` - Demo form with entry list\n- `base.html` - Template inheritance base\n\n**Structure:**\n```html\n<!DOCTYPE html>\n<html>\n<head>\n    <link rel=\"stylesheet\" href=\"/static/css/style.css\">\n</head>\n<body>\n    <main>\n        <!-- Page content -->\n    </main>\n</body>\n</html>\n```\n\n#### CSS Stylesheet\n\nSingle CSS file providing visual styling:\n\n```css\n/* style.css - Key sections */\nbody { font-family: Arial; max-width: 600px; margin: 50px auto; }\nform { margin: 20px 0; }\ninput[type=\"text\"] { padding: 10px; width: 300px; }\nbutton { padding: 10px 20px; background: #007bff; }\n.entry { padding: 10px; border-bottom: 1px solid #eee; }\n```\n\n#### HTML Forms\n\nThe demo page contains a form for creating entries:\n\n```html\n<form method=\"POST\" action=\"/demo/\">\n    <input type=\"text\" name=\"value\" placeholder=\"Enter a value...\" required>\n    <button type=\"submit\">Add Entry</button>\n</form>\n```\n\n**Form Behavior:**\n1. User enters text\n2. Clicks \"Add Entry\"\n3. Browser POSTs form data to `/demo/`\n4. Server processes and redirects\n5. Browser follows redirect\n\n#### Navigation\n\nHTML anchor elements for page navigation:\n\n```html\n<nav>\n    <ul>\n        <li><a href=\"/demo\">Demo Application</a></li>\n        <li><a href=\"/api/health\">Health Check</a></li>\n    </ul>\n</nav>\n```\n\n---\n\n## Tier 2: Application Components (Flask Server)\n\n### Component Diagram\n\n![](embed:C3-ApplicationTier)\n\n### Application Component Inventory\n\n| Layer | Component | Technology | Purpose |\n|-------|-----------|------------|---------|\n| **Infrastructure** | nginx | nginx | Reverse proxy, SSL |\n| **Infrastructure** | Gunicorn | Gunicorn | WSGI server |\n| **Application** | Flask App | Flask | App factory |\n| **Routing** | Main Blueprint | Flask | Landing page (`/`) |\n| **Routing** | Demo Blueprint | Flask | Demo form (`/demo`) |\n| **Routing** | API Blueprint | Flask | JSON API (`/api/*`) |\n| **Business Logic** | Entry Service | Python | CRUD operations |\n| **Data Access** | Entry Model | SQLAlchemy | ORM mapping |\n| **Templates** | Jinja2 Templates | Jinja2 | HTML generation |\n| **Static** | Static Files | CSS | Stylesheets |\n\n### Application Component Details\n\n#### nginx (Reverse Proxy)\n\nHandles incoming HTTPS requests:\n\n```nginx\nserver {\n    listen 443 ssl;\n    ssl_certificate /etc/nginx/ssl/flask-app.crt;\n\n    location / {\n        proxy_pass http://127.0.0.1:5001;\n        proxy_set_header X-Real-IP $remote_addr;\n    }\n\n    location /static {\n        alias /opt/flask-app/app/static;\n    }\n}\n```\n\n**Responsibilities:**\n- SSL termination (self-signed certificate)\n- Proxy requests to Gunicorn\n- Serve static files directly\n- Add proxy headers\n\n#### Gunicorn (WSGI Server)\n\nProduction HTTP server:\n\n```bash\ngunicorn --bind 0.0.0.0:5001 --workers 2 wsgi:app\n```\n\n**Responsibilities:**\n- Process management (2 workers)\n- Request handling\n- Application loading\n\n#### Flask App (Application Factory)\n\nCreates and configures the application:\n\n```python\ndef create_app(config_name='development'):\n    app = Flask(__name__)\n    app.config.from_object(config_map[config_name])\n\n    db.init_app(app)\n    migrate.init_app(app, db)\n\n    app.register_blueprint(main_bp)\n    app.register_blueprint(demo_bp)\n    app.register_blueprint(api_bp)\n\n    return app\n```\n\n#### Blueprints (Route Handlers)\n\nThree blueprints organize routes:\n\n| Blueprint | Prefix | Routes | Handler |\n|-----------|--------|--------|---------|\n| `main_bp` | `/` | `GET /` | `main.py` |\n| `demo_bp` | `/demo` | `GET/POST /demo/` | `demo.py` |\n| `api_bp` | `/api` | `GET /api/health`, `GET /api/entries` | `api.py` |\n\n**Demo Blueprint Example:**\n```python\n@demo_bp.route('/', methods=['GET', 'POST'])\ndef index():\n    if request.method == 'POST':\n        value = request.form.get('value')\n        if value:\n            EntryService.create_entry(value)\n        return redirect(url_for('demo.index'))\n\n    entries = EntryService.get_recent_entries(limit=10)\n    return render_template('demo.html', entries=entries)\n```\n\n#### Entry Service (Business Logic)\n\nEncapsulates database operations:\n\n```python\nclass EntryService:\n    @staticmethod\n    def create_entry(value):\n        entry = Entry(value=value)\n        db.session.add(entry)\n        db.session.commit()\n        return entry\n\n    @staticmethod\n    def get_recent_entries(limit=10):\n        return Entry.query.order_by(Entry.created_at.desc()).limit(limit).all()\n```\n\n#### Entry Model (Data Access)\n\nSQLAlchemy ORM model:\n\n```python\nclass Entry(db.Model):\n    __tablename__ = 'entries'\n\n    id = db.Column(db.Integer, primary_key=True)\n    value = db.Column(db.Text, nullable=False)\n    created_at = db.Column(db.DateTime, default=lambda: datetime.now(timezone.utc))\n\n    def to_dict(self):\n        return {'id': self.id, 'value': self.value, 'created_at': self.created_at.isoformat()}\n```\n\n---\n\n## Tier 3: Data Components (PostgreSQL)\n\n### Component Diagram\n\n![](embed:C3-DataTier)\n\n### Database Schema\n\n| Table | Column | Type | Constraints |\n|-------|--------|------|-------------|\n| `entries` | `id` | INTEGER | PRIMARY KEY |\n| `entries` | `value` | TEXT | NOT NULL |\n| `entries` | `created_at` | TIMESTAMP | DEFAULT now() |\n\n### SQL Operations\n\n| Operation | SQL | Python (SQLAlchemy) |\n|-----------|-----|---------------------|\n| Create | `INSERT INTO entries (value) VALUES (...)` | `db.session.add(entry)` |\n| Read All | `SELECT * FROM entries ORDER BY created_at DESC` | `Entry.query.order_by(...).all()` |\n| Read Recent | `SELECT * FROM entries ORDER BY created_at DESC LIMIT 10` | `Entry.query.limit(10).all()` |\n| Count | `SELECT COUNT(*) FROM entries` | `Entry.query.count()` |\n\n### Database Configuration\n\n| Setting | Value |\n|---------|-------|\n| Host | `psql-flask-dev.postgres.database.azure.com` |\n| Port | 5432 |\n| Database | `flask` |\n| SSL Mode | `require` |\n| User | `adminuser` |\n\n---\n\n## Request Flow Through All Tiers\n\n### Complete Request Lifecycle\n\n```\n1. USER ACTION (Tier 1)\n   User clicks \"Add Entry\" button\n        │\n        ▼\n2. FORM SUBMISSION (Tier 1 → Tier 2)\n   Browser POSTs to /demo/\n        │\n        ▼\n3. NGINX (Tier 2 - Infrastructure)\n   SSL termination, proxy to Gunicorn\n        │\n        ▼\n4. GUNICORN (Tier 2 - Infrastructure)\n   Routes request to Flask app\n        │\n        ▼\n5. DEMO BLUEPRINT (Tier 2 - Routing)\n   @demo_bp.route('/') handles POST\n        │\n        ▼\n6. ENTRY SERVICE (Tier 2 - Business Logic)\n   EntryService.create_entry(value)\n        │\n        ▼\n7. ENTRY MODEL (Tier 2 - Data Access)\n   entry = Entry(value=value)\n   db.session.add(entry)\n        │\n        ▼\n8. POSTGRESQL (Tier 3)\n   INSERT INTO entries (value, created_at) VALUES (...)\n        │\n        ▼\n9. REDIRECT (Tier 2 → Tier 1)\n   return redirect(url_for('demo.index'))\n        │\n        ▼\n10. PAGE RENDER (Tier 2 → Tier 1)\n    Jinja2 renders demo.html with entries\n        │\n        ▼\n11. BROWSER DISPLAY (Tier 1)\n    HTML page renders with new entry visible\n```\n\n### Next Level\n\nSee [Deployment](05-deployment.md) for how these components are deployed on Azure.\n",
          "filename" : "04-components.md",
          "format" : "Markdown",
          "order" : 4,
          "title" : ""
        }, {
          "content" : "# Deployment\n\n## Simplified Azure Deployment Architecture\n\nThis document shows how the Flask Three-Tier Application is deployed on Azure using a simplified IaaS approach designed for learning environments.\n\n### Deployment Diagram\n\n![](embed:Deployment)\n\n### Infrastructure Overview\n\n#### Network Topology\n\n| Subnet | CIDR | NSG | Purpose |\n|--------|------|-----|---------|\n| `snet-default` | 10.0.0.0/24 | `nsg-default` | Application server (public access) |\n\n#### Virtual Machine\n\n| VM | Subnet | Public IP | Size | Purpose |\n|----|--------|-----------|------|---------|\n| `vm-app` | snet-default | Yes (`pip-app`) | Standard_B1s | Combined nginx + Flask |\n\n#### Managed Services\n\n| Service | SKU | Purpose |\n|---------|-----|---------|\n| PostgreSQL Flexible Server | Burstable B1ms | Database (public access) |\n\n### Security Architecture\n\n#### Network Security Group (nsg-default)\n\nSingle NSG with simplified rules for learning environment:\n\n| Priority | Name | Direction | Port | Source | Action |\n|----------|------|-----------|------|--------|--------|\n| 100 | AllowSSH | Inbound | 22 | Internet | Allow |\n| 110 | AllowHTTP | Inbound | 80 | Internet | Allow |\n| 120 | AllowHTTPS | Inbound | 443 | Internet | Allow |\n| 65000 | DenyAllInbound | Inbound | * | * | Deny |\n\n#### PostgreSQL Firewall\n\n| Rule | Start IP | End IP | Purpose |\n|------|----------|--------|---------|\n| AllowAll | 0.0.0.0 | 255.255.255.255 | Learning environment only |\n\n> **Warning**: Public PostgreSQL access is for learning only. Production environments must use private endpoints.\n\n### Deployment Process\n\n#### One-Command Deployment\n\n```bash\n# Deploy everything (10-15 minutes)\n./deploy-all.sh\n```\n\n#### Step-by-Step Deployment\n\n```bash\n# 1. Provision Azure infrastructure\n./infrastructure/provision.sh\n\n# 2. Wait for PostgreSQL to be ready\n./deploy/scripts/wait-for-postgresql.sh\n\n# 3. Wait for VM cloud-init to complete\n./deploy/scripts/wait-for-cloud-init.sh\n\n# 4. Deploy the Flask application\n./deploy/deploy.sh\n\n# 5. Wait for application to be healthy\n./deploy/scripts/wait-for-flask-app.sh\n\n# 6. Run verification tests\n./deploy/scripts/verification-tests.sh\n```\n\n#### Cloud-init Configuration\n\nThe VM is automatically configured via cloud-init (`app-server.yaml`):\n\n| Component | Configuration |\n|-----------|---------------|\n| nginx | Reverse proxy with self-signed SSL |\n| Python | Python 3, pip, virtual environment |\n| fail2ban | SSH brute-force protection |\n| flask-app user | System user for running application |\n| systemd | flask-app.service unit |\n\n#### Application Deployment\n\nThe Flask application is deployed via direct SSH/SCP:\n\n```\n1. SCP application files to /opt/flask-app/\n2. Install Python dependencies in virtualenv\n3. Configure DATABASE_URL in /etc/flask-app/app.env\n4. Initialize database tables (db.create_all())\n5. Restart flask-app systemd service\n```\n\n### Cost Estimate\n\n| Resource | SKU | Monthly Cost |\n|----------|-----|--------------|\n| 1x VM | Standard_B1s | ~$7 |\n| PostgreSQL | Burstable B1ms | ~$12 |\n| Public IP | 1x Static | ~$4 |\n| Storage | 30GB | ~$1 |\n| **Total** | | **~$24/month** |\n\n### Naming Conventions\n\nFollowing Azure Cloud Adoption Framework (CAF):\n\n| Resource Type | Pattern | Example |\n|---------------|---------|---------|\n| Resource Group | `rg-{project}-{env}` | `rg-flask-dev` |\n| Virtual Network | `vnet-{project}-{env}` | `vnet-flask-dev` |\n| Subnet | `snet-{purpose}` | `snet-default` |\n| NSG | `nsg-{purpose}` | `nsg-default` |\n| VM | `vm-{role}` | `vm-app` |\n| Public IP | `pip-{role}` | `pip-app` |\n| PostgreSQL | `psql-{project}-{env}` | `psql-flask-dev` |\n\n### Infrastructure as Code\n\nAll infrastructure is defined in Bicep:\n\n```\ninfrastructure/\n├── provision.sh              # Deployment orchestrator\n├── main.bicep                # Entry point\n├── modules/\n│   ├── network.bicep         # VNet, subnet, NSG\n│   ├── vm.bicep              # Application server VM\n│   └── database.bicep        # PostgreSQL\n├── cloud-init/\n│   └── app-server.yaml       # VM configuration\n├── scripts/\n│   ├── init-secrets.sh       # Generate parameters.json\n│   └── validate-password.sh  # Password validation\n└── parameters.json           # GITIGNORED - secrets\n```\n\n### Verification Tests\n\nThe deployment runs 6 verification tests:\n\n| Test | Endpoint | Expected |\n|------|----------|----------|\n| E1 | `/api/health` | `{\"status\": \"ok\"}` |\n| E2 | `/` | Landing page HTML |\n| E3 | `/demo` | Demo form HTML |\n| E4 | `/api/entries` | JSON array |\n| E5 | Database | `SELECT 1` succeeds |\n| E6 | Schema | `entries` table exists |\n\n### Troubleshooting\n\n#### Check Service Status\n\n```bash\nVM_IP=$(az vm show -g rg-flask-dev -n vm-app --show-details -o tsv --query publicIps)\nssh azureuser@$VM_IP \"sudo systemctl status flask-app\"\nssh azureuser@$VM_IP \"sudo systemctl status nginx\"\n```\n\n#### View Logs\n\n```bash\n# Flask/Gunicorn logs\nssh azureuser@$VM_IP \"sudo journalctl -u flask-app -n 50\"\n\n# nginx access log\nssh azureuser@$VM_IP \"sudo tail -f /var/log/nginx/access.log\"\n\n# Cloud-init log\nssh azureuser@$VM_IP \"sudo cat /var/log/cloud-init-output.log\"\n```\n\n#### Database Connection\n\n```bash\n# Check environment variable\nssh azureuser@$VM_IP \"sudo cat /etc/flask-app/app.env\"\n\n# Test connection\nssh azureuser@$VM_IP 'eval $(sudo cat /etc/flask-app/app.env) && psql \"$DATABASE_URL\" -c \"SELECT 1;\"'\n```\n\n### Related Documentation\n\n- [Overview](01-overview.md) - Project overview\n- [System Context](02-context.md) - C1 diagram\n- [Containers](03-containers.md) - C2 diagram\n- [Components](04-components.md) - C3 diagram\n",
          "filename" : "05-deployment.md",
          "format" : "Markdown",
          "order" : 5,
          "title" : ""
        } ]
      },
      "id" : "3",
      "name" : "Flask Three-Tier Application",
      "properties" : {
        "structurizr.dsl.identifier" : "flaskApp"
      },
      "tags" : "Element,Software System"
    } ]
  },
  "name" : "Flask Three-Tier Application",
  "properties" : {
    "structurizr.inspection.error" : "1",
    "structurizr.inspection.info" : "0",
    "structurizr.inspection.ignore" : "0",
    "structurizr.inspection.warning" : "0"
  },
  "views" : {
    "componentViews" : [ {
      "containerId" : "4",
      "description" : "What renders and runs in the browser",
      "dimensions" : {
        "height" : 2416,
        "width" : 3400
      },
      "elements" : [ {
        "id" : "1",
        "x" : 208,
        "y" : 383
      }, {
        "id" : "5",
        "x" : 1604,
        "y" : 433
      }, {
        "id" : "6",
        "x" : 1979,
        "y" : 1083
      }, {
        "id" : "7",
        "x" : 1229,
        "y" : 1083
      }, {
        "id" : "8",
        "x" : 1229,
        "y" : 1683
      }, {
        "id" : "9",
        "x" : 2637,
        "y" : 1683
      } ],
      "externalContainerBoundariesVisible" : false,
      "key" : "C3-PresentationTier",
      "name" : "Component View: Flask Three-Tier Application - Web Browser",
      "order" : 3,
      "paperSize" : "A4_Landscape",
      "relationships" : [ {
        "id" : "27"
      }, {
        "id" : "28"
      }, {
        "id" : "29",
        "vertices" : [ {
          "x" : 1079,
          "y" : 1083
        }, {
          "x" : 1079,
          "y" : 1383
        } ]
      }, {
        "id" : "30"
      }, {
        "id" : "32",
        "vertices" : [ {
          "x" : 1923,
          "y" : 1833
        }, {
          "x" : 2393,
          "y" : 1833
        } ]
      }, {
        "id" : "35",
        "vertices" : [ {
          "x" : 1829,
          "y" : 1383
        } ]
      }, {
        "id" : "49",
        "vertices" : [ {
          "x" : 2579,
          "y" : 1083
        } ]
      }, {
        "id" : "53"
      } ]
    }, {
      "containerId" : "9",
      "description" : "Flask application server internals",
      "dimensions" : {
        "height" : 4662,
        "width" : 3370
      },
      "elements" : [ {
        "id" : "4",
        "x" : 2591,
        "y" : 2833
      }, {
        "id" : "10",
        "x" : 1933,
        "y" : 433
      }, {
        "id" : "11",
        "x" : 1183,
        "y" : 1033
      }, {
        "id" : "12",
        "x" : 1183,
        "y" : 1633
      }, {
        "id" : "13",
        "x" : 433,
        "y" : 2233
      }, {
        "id" : "14",
        "x" : 1183,
        "y" : 2233
      }, {
        "id" : "15",
        "x" : 1933,
        "y" : 2233
      }, {
        "id" : "16",
        "x" : 1841,
        "y" : 2833
      }, {
        "id" : "17",
        "x" : 1841,
        "y" : 3433
      }, {
        "id" : "18",
        "x" : 1091,
        "y" : 2833
      }, {
        "id" : "19",
        "x" : 1933,
        "y" : 1033
      }, {
        "id" : "20",
        "x" : 1841,
        "y" : 4033
      } ],
      "externalContainerBoundariesVisible" : false,
      "key" : "C3-ApplicationTier",
      "name" : "Component View: Flask Three-Tier Application - Application Server",
      "order" : 4,
      "paperSize" : "A3_Portrait",
      "relationships" : [ {
        "id" : "33",
        "vertices" : [ {
          "x" : 2533,
          "y" : 1033
        } ]
      }, {
        "id" : "36"
      }, {
        "id" : "37"
      }, {
        "id" : "38"
      }, {
        "id" : "39"
      }, {
        "id" : "40"
      }, {
        "id" : "41"
      }, {
        "id" : "42"
      }, {
        "id" : "43"
      }, {
        "id" : "44"
      }, {
        "id" : "45"
      }, {
        "id" : "46"
      }, {
        "id" : "48",
        "vertices" : [ {
          "x" : 1841,
          "y" : 2683
        }, {
          "x" : 2412,
          "y" : 2683
        } ]
      }, {
        "id" : "52"
      }, {
        "id" : "54"
      }, {
        "id" : "56"
      } ]
    }, {
      "containerId" : "20",
      "description" : "Database schema and tables",
      "dimensions" : {
        "height" : 1662,
        "width" : 1316
      },
      "elements" : [ {
        "id" : "9",
        "x" : 433,
        "y" : 329
      }, {
        "id" : "21",
        "x" : 433,
        "y" : 929
      } ],
      "externalContainerBoundariesVisible" : false,
      "key" : "C3-DataTier",
      "name" : "Component View: Flask Three-Tier Application - PostgreSQL Database",
      "order" : 5,
      "paperSize" : "A5_Portrait",
      "relationships" : [ {
        "id" : "57"
      } ]
    } ],
    "configuration" : {
      "branding" : { },
      "lastSavedView" : "Deployment",
      "styles" : {
        "elements" : [ {
          "background" : "#a23b72",
          "color" : "#ffffff",
          "tag" : "Application Tier"
        }, {
          "shape" : "WebBrowser",
          "tag" : "Client"
        }, {
          "background" : "#85bbf0",
          "color" : "#000000",
          "tag" : "Component"
        }, {
          "background" : "#438dd5",
          "color" : "#ffffff",
          "tag" : "Container"
        }, {
          "background" : "#f18f01",
          "color" : "#ffffff",
          "tag" : "Data Tier"
        }, {
          "shape" : "Cylinder",
          "tag" : "Database"
        }, {
          "background" : "#ffffff",
          "color" : "#cc0000",
          "tag" : "NSG"
        }, {
          "background" : "#08427b",
          "color" : "#ffffff",
          "shape" : "Person",
          "tag" : "Person"
        }, {
          "background" : "#2e86ab",
          "color" : "#ffffff",
          "tag" : "Presentation Tier"
        }, {
          "background" : "#08427b",
          "color" : "#ffffff",
          "tag" : "Primary Actor"
        }, {
          "background" : "#5c5c5c",
          "color" : "#ffffff",
          "tag" : "Secondary Actor"
        }, {
          "background" : "#438dd5",
          "color" : "#ffffff",
          "tag" : "Software System"
        } ]
      },
      "terminology" : { },
      "themes" : [ "https://static.structurizr.com/themes/default/theme.json" ]
    },
    "containerViews" : [ {
      "description" : "Container diagram showing the three tiers",
      "dimensions" : {
        "height" : 2825,
        "width" : 1316
      },
      "elements" : [ {
        "id" : "1",
        "x" : 458,
        "y" : 208
      }, {
        "id" : "4",
        "x" : 433,
        "y" : 908
      }, {
        "id" : "9",
        "x" : 433,
        "y" : 1508
      }, {
        "id" : "20",
        "x" : 433,
        "y" : 2108
      } ],
      "externalSoftwareSystemBoundariesVisible" : false,
      "key" : "C2-Containers",
      "name" : "Container View: Flask Three-Tier Application",
      "order" : 2,
      "paperSize" : "A4_Portrait",
      "relationships" : [ {
        "id" : "24"
      }, {
        "id" : "25"
      }, {
        "id" : "26"
      } ],
      "softwareSystemId" : "3"
    } ],
    "deploymentViews" : [ {
      "description" : "Azure deployment showing all three tiers",
      "dimensions" : {
        "height" : 2875,
        "width" : 2379
      },
      "elements" : [ {
        "id" : "58",
        "x" : 175,
        "y" : 175
      }, {
        "id" : "59",
        "x" : 350,
        "y" : 350
      }, {
        "id" : "60",
        "x" : 1287,
        "y" : 433
      }, {
        "id" : "61",
        "x" : 350,
        "y" : 350
      }, {
        "id" : "62",
        "x" : 350,
        "y" : 350
      }, {
        "id" : "63",
        "x" : 175,
        "y" : 175
      }, {
        "id" : "64",
        "x" : 175,
        "y" : 175
      }, {
        "id" : "65",
        "x" : 1287,
        "y" : 1391
      }, {
        "id" : "68",
        "x" : 537,
        "y" : 1391
      }, {
        "id" : "70",
        "x" : 350,
        "y" : 350
      }, {
        "id" : "71",
        "x" : 1287,
        "y" : 2141
      } ],
      "environment" : "Production",
      "key" : "Deployment",
      "name" : "Deployment View: Flask Three-Tier Application - Production",
      "order" : 6,
      "paperSize" : "A4_Portrait",
      "relationships" : [ {
        "id" : "66",
        "vertices" : [ {
          "x" : 1662,
          "y" : 1062
        } ]
      }, {
        "id" : "67",
        "vertices" : [ {
          "x" : 1362,
          "y" : 1062
        } ]
      }, {
        "id" : "69"
      }, {
        "id" : "72"
      } ],
      "softwareSystemId" : "3"
    } ],
    "systemContextViews" : [ {
      "automaticLayout" : {
        "applied" : false,
        "edgeSeparation" : 0,
        "implementation" : "Graphviz",
        "nodeSeparation" : 300,
        "rankDirection" : "LeftRight",
        "rankSeparation" : 300,
        "vertices" : false
      },
      "description" : "System Context showing actors and the three-tier system",
      "elements" : [ {
        "id" : "1",
        "x" : 0,
        "y" : 0
      }, {
        "id" : "2",
        "x" : 0,
        "y" : 0
      }, {
        "id" : "3",
        "x" : 0,
        "y" : 0
      } ],
      "enterpriseBoundaryVisible" : true,
      "key" : "C1-Context",
      "name" : "System Context View: Flask Three-Tier Application",
      "order" : 1,
      "relationships" : [ {
        "id" : "22"
      }, {
        "id" : "23"
      } ],
      "softwareSystemId" : "3"
    } ]
  }
}